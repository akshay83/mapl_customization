[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Receipt", 
  "modified": "2016-02-08 23:30:11.718795", 
  "name": "Purchase Receipt-Client", 
  "script": "cur_frm.add_fetch('item_code','is_vehicle','is_vehicle');\n/***************************************************************/\n/*              Invoke Dialog On Child Form                    */\n/***************************************************************/\n\nfrappe.ui.form.on(\"Purchase Receipt\", \"items_on_form_rendered\", function(frm) {\n        // Important Note : Sub Form Fieldname+\"_on_form_rendered\" would trigger and add\n        // The button in child form\n\tvar grid_row = cur_frm.open_grid_row();\n\n        // Add Button to Child Form ... Wrap it around the \"dialog_result\" field\n        var $btn = $('<button class=\"btn btn-sm btn-default\">'+__(\"Add Serial No\")+'</button>')\n                .appendTo($(\"<div>\")\n\t\t.css({\"margin-bottom\": \"10px\", \"margin-top\": \"10px\"})\n\t\t.appendTo(grid_row.fields_dict.serial_no.$wrapper));\n\n        // Bind a Event to Added Button\n        $btn.on(\"click\", function() {\n        var fields = [];\n        for (var rows=1;rows<=grid_row.fields_dict.received_qty.get_value()+1;rows++) {\n            fields.push({label:\"Row No:\".concat(rows), fieldname: \"row_no_\".concat(rows), fieldtype: \"Section Break\"});\n            for (var columns=1;columns<=3;columns++) {\n                if (columns == 1) {\n                    fields.push({label:\"Serial/Chassis No\", fieldname: \"chassis_no_\".concat(rows), fieldtype: \"Data\", reqd:1});\n                }\n\t\tif (grid_row.fields_dict['is_vehicle'].value==1) {\n\t\t\tif (columns == 2) {\n\t                    fields.push({label:\"Engine No\", fieldname: \"engine_no_\".concat(rows), fieldtype: \"Data\", reqd:1});\n\t                }\n\t                if (columns == 3) {\n        \t            fields.push({label:\"Key No\", fieldname: \"key_no_\".concat(rows), fieldtype: \"Data\", reqd:1});\n\t                \t}\n        \t        if (columns < 3) {\n\t                    fields.push({fieldname: \"column_no_\".concat(columns), fieldtype: \"Column Break\"});\n                \t}\n\t\t}\n            }\n        }\n        // Add \"Add\" Button to the Dialog\n        fields.push({fieldtype: \"Section Break\"});\n        //fields.push({fieldtype: \"Button\", \"label\": \"Set\", fieldname: \"add\"});\n\n\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __(\"Add Serial No\"),\n                                fields\n\t\t\t});\n\n               if (grid_row.fields_dict.serial_no.get_value()!=\"\") {\n                    var existing_serial_no = grid_row.fields_dict.serial_no.get_value().split(\"\\n\");\n                    var existing_engine_no = grid_row.fields_dict.serial_no.get_value().split(\"\\n\");\n                    var existing_key_no = grid_row.fields_dict.serial_no.get_value().split(\"\\n\");\n                    for (var row=1;row<=existing_serial_no.length+1;row++) {\n                             d.set_value(\"chassis_no_\".concat(row),existing_serial_no[row-1]);\n                             d.set_value(\"engine_no_\".concat(row),existing_engine_no[row-1]);\n                             d.set_value(\"key_no_\".concat(row),existing_key_no[row-1]);\n                    }\n               }\n                        //Bind Event to Add Button in Dialog\n\t\t\td.set_primary_action(__(\"Save\"), function() {\n/*****************/\n\t\targs = d.get_values();\n\t\tif (!args) return;\n\t\tfrappe.call({\n\t\t\tmethod:\"mapl_customization.customizations_for_mapl.utils.validate_input_serial\",\n\t\t\targs : { \"args\": d.get_values(),\n                                 \"rows\": grid_row.fields_dict.received_qty.get_value()+1,\n                                 \"is_vehicle\": grid_row.fields_dict['is_vehicle'].value\n                                },\n\n\t\t\tcallback: function (r) {\n\t\t\t\tif (!r.message) {\n                                   //return;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n/*****************/\n\n\t\t\t//d.get_input(\"add\").on(\"click\", function() {\n                            var result_serial_no = \"\";\n                            var result_engine_no = \"\";\n                            var result_key_no = \"\";\n                                    for (var rows=1;rows<=grid_row.fields_dict.received_qty.get_value()+1;rows++) {\n                                            result_serial_no = result_serial_no.concat(d.get_value(\"chassis_no_\".concat(rows)),\"\\n\");\n                                    //Set Resultant Value from Dialog in a Child Form Field - Here dialog_result\n                                    grid_row.fields_dict.serial_no.set_model_value(result_serial_no);\n                                            result_engine_no = result_engine_no.concat(d.get_value(\"engine_no_\".concat(rows)),\"\\n\");\n                                    //Set Resultant Value from Dialog in a Child Form Field - Here dialog_result\n                                    grid_row.fields_dict.engine_nos.set_model_value(result_engine_no);\n                                            result_key_no = result_key_no.concat(d.get_value(\"key_no_\".concat(rows)),\"\\n\");\n                                    //Set Resultant Value from Dialog in a Child Form Field - Here dialog_result\n                                    grid_row.fields_dict.key_nos.set_model_value(result_key_no);\n                         }\n\t\t\t\td.hide();\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\td.show();\n\t\t});\n        });\n/***************************************************************/\n/*              End Dialog On Child Form                       */\n/***************************************************************/\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Customer", 
  "modified": "2016-02-12 13:18:36.901635", 
  "name": "Customer-Client", 
  "script": "frappe.ui.form.on(\"Customer\", {\n\trefresh: function(frm) {\n\t\tif (frm.doc.__islocal) {\n\t\t\tfrm.add_custom_button(__('Quick Entry'), function() {\n\t\t\t\treturn cur_frm.quick_entry(frm);\n\t\t\t});\n\t\t}\n        }\n});\n\ncur_frm.quick_entry = function (doc) {\n\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Quick Customer Entry\"),\n\t\t\tfields: [\n\t\t\t\t{fieldtype: \"Select\", fieldname: \"customer_type\", label: __(\"Customer Type\"), reqd: 1, options: \"Company\\nIndividual\"},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"customer_name\", label: __(\"Customer Name\"), reqd: 1},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"tax_id\", label: __(\"Tax ID\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"primary_contact_no\", label: __(\"Primary Contact No\"), reqd: 1},\n\t\t\t\t{fieldtype: \"Column Break\", fieldname: \"column_break_2\"},\n\t\t\t\t{fieldtype: \"Link\", fieldname: \"customer_group\", label: __(\"Customer Group\"), reqd: 1, options: \"Customer Group\"},\n\t\t\t\t{fieldtype: \"Link\", fieldname: \"territory\", label: __(\"Territory\"), reqd: 1, options: \"Territory\"},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"pan_no\", label: __(\"PAN No\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"secondary_contact_no\", label: __(\"Secondary Contact No\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Section Break\", fieldname: \"section_break_1\"},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"billing_address_1\", label: __(\"Billing Address 1\"), reqd: 1},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"billing_address_2\", label: __(\"Billing Address 2\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"billing_city\", label: __(\"Billing City\"), reqd: 1},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"billing_state\", label: __(\"Billing State\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Link\", fieldname: \"billing_country\", label: __(\"Billing Country\"), reqd: 0, options:\"Country\"},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"billing_phone\", label: __(\"Billing Phone\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"billing_fax\", label: __(\"Billing Fax\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"billing_email_id\", label: __(\"Billing Email ID\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Column Break\", fieldname: \"column_break_1\"},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"shipping_address_1\", label: __(\"Shipping Address 1\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"shipping_address_2\", label: __(\"Shipping Address 2\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"shipping_city\", label: __(\"Shipping City\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"shipping_state\", label: __(\"Shipping State\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Link\", fieldname: \"shipping_country\", label: __(\"Shipping Country\"), reqd: 0, options:\"Country\"},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"shipping_phone\", label: __(\"Shipping Phone\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"shipping_fax\", label: __(\"Shipping Fax\"), reqd: 0},\n\t\t\t\t{fieldtype: \"Data\", fieldname: \"shipping_email_id\", label: __(\"Shipping Email ID\"), reqd: 0}\n\t\t\t]\n\t\t});    \n\n\n\tdialog.set_primary_action(__(\"Save\"), function() {\n\t\targs = dialog.get_values();\n\t\tif (!args) return;\n\t\tfrappe.call({\n\t\t\tmethod:\"mapl_customization.customizations_for_mapl.quick_customer.do_quick_entry\",\n\t\t\targs : { \"args\": dialog.get_values() },\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t\t\tdialog.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\n\tdialog.show();\n}\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2016-02-18 20:09:29.305435", 
  "name": "Sales Invoice-Client", 
  "script": "cur_frm.add_fetch('item_code','is_vehicle','is_vehicle');\ncur_frm.add_fetch('customer','customer_name','customer_name');\nfrappe.ui.form.on(\"Sales Invoice\", \"is_finance\", function (frm) {\n         cur_frm.set_df_property(\"hypothecation\", \"reqd\", frm.doc.is_finance==1);\n         cur_frm.refresh_field(\"hypothecation\");\n});\nfrappe.ui.form.on(\"Sales Invoice\", \"customer\", function (frm) {\n        cur_frm.set_df_property(\"customer_name\", \"hidden\", false);\n             if (frm.doc.customer) {\n\t\tfrappe.call({\n\t\t\tmethod: \"mapl_customization.customizations_for_mapl.utils.get_customer_balance\",\n\t\t\targs: {\n\t\t\t\tcustomer: frm.doc.customer,\n\t\t\t\tcompany: frm.doc.company\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc && r.message) {\n                                    var alert_msg = frm.doc.customer+\" Current Balance:\";\n                                    if (parseFloat(r.message) > 0) {\n                                          alert_msg = alert_msg+\"<b><span style=\\\"color:red;\\\">\"+parseFloat(r.message)+\" Dr.</span></b>\";\n                                    } else if (parseFloat(r.message) < 0) {\n                                          alert_msg = alert_msg+\"<b><span style=\\\"color:blue;\\\">\"+parseFloat(r.message)+\" Cr.</span></b>\";\n                                    } else {\n                                          alert_msg = alert_msg+\"<b><span style=\\\"color:black;\\\"> 0.00</span></b>\";\n                                    }\n\t\t\t\t\t  \t\t\t\t\t  show_alert(alert_msg, 8);\n\t\t\t\t} else {\n                                          show_alert(frm.doc.customer+\" Current Balance:<b><span style=\\\"color:black;\\\"> 0.00</span></b>\",8);\n                                    }\n\t\t\t}\n\t\t});          \n            }\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Stock Problem", 
  "modified": "2016-02-10 22:59:54.186859", 
  "name": "Stock Problem-Client", 
  "script": "frappe.ui.form.on(\"Stock Problem\", \"refresh\", function (frm) {\n   cur_frm.toggle_enable(\"status\",frm.doc.status===\"Open\")\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Delivery Note", 
  "modified": "2016-02-10 23:16:09.773416", 
  "name": "Delivery Note-Client", 
  "script": "cur_frm.add_fetch('item_code','is_vehicle','is_vehicle');", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Receipts", 
  "modified": "2016-02-14 14:29:47.695381", 
  "name": "Receipts-Client", 
  "script": "frappe.ui.form.on(\"Receipts\", \"onload\", function(frm) {\n\tfrm.set_query(\"payment_account\", function() {\n\t\treturn {\n\t\t\tfilters: {\n\t\t\t\t\"account_type\": [\"in\", [\"Bank\", \"Cash\"]],\n\t\t\t\t\"is_group\": 0,\n\t\t\t\t\"company\": frm.doc.company\n\t\t\t}\n\t\t}\n\t});\n});\n\nfrappe.ui.form.on(\"Receipts\", \"party\", function(frm) {\n\tif(frm.doc.party_type && frm.doc.party) {\n\t\tfrappe.call({\n\t\t\tmethod: \"mapl_customization.customizations_for_mapl.utils.get_party_name\",\n\t\t\targs: {\n\t\t\t\tparty_type: frm.doc.party_type,\n\t\t\t\tparty: frm.doc.party\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\tfrm.set_value(\"party_name\", r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});    \n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.party.get_party_account\",\n\t\t\targs: {\n\t\t\t\tcompany: frm.doc.company,\n\t\t\t\tparty_type: frm.doc.party_type,\n\t\t\t\tparty: frm.doc.party\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\tfrm.set_value(\"party_account\", r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n          frm.call({\n            method: \"mapl_customization.customizations_for_mapl.utils.get_primary_billing_address\",\n            args: {\n\t\t\t\tparty_type: frm.doc.party_type,\n\t\t\t\tparty: frm.doc.party\n            },\n            callback: function(r) {\n                  if(r.message)\n                     frm.set_value(\"party_address\", r.message);\n                  else\n                     frm.set_value(\"party_address\", null);\n                } \n        });\n\t}\n});\n\nfrappe.ui.form.on(\"Receipts\", \"party_address\", function(frm) {\n   if (frm.doc.party_address) {\n          frm.call({\n            method: \"mapl_customization.customizations_for_mapl.utils.fetch_address_details_payments_receipts\",\n            args: {\n                party_address: frm.doc.party_address\n            },\n            callback: function(r) {\n                  if(r.message)\n                     frm.set_value(\"address\", r.message);\n                }\n        });   \n   } else\n        frm.set_value(\"address\", null);   \n});\n// Fetch bank/cash account based on payment mode\nfrappe.ui.form.on(\"Receipts\", \"payment_mode\", function(frm) {\n\treturn  frappe.call({\n\t\tmethod: \"erpnext.accounts.doctype.sales_invoice.sales_invoice.get_bank_cash_account\",\n\t\targs: {\n\t\t\t\t\"mode_of_payment\": frm.doc.payment_mode,\n\t\t\t\t\"company\": frm.doc.company\n\t\t},\n\t\tcallback: function(r, rt) {\n\t\t\tif(r.message) {\n\t\t\t\tcur_frm.set_value(\"payment_account\", r.message['account']);\n\t\t\t}\n\t\t}\n\t});\n});\n\n\ncur_frm.fields_dict['party_address'].get_query = function(doc, cdt, cdn) {\n      if (doc.party_type==\"Customer\") {\n\treturn{\n    \tfilters:{'customer': doc.party}\n  \t}\n      } else {\n\treturn{\n    \tfilters:{'supplier': doc.party}\n  \t}\n      }\n};", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Payments", 
  "modified": "2016-02-14 14:30:17.106670", 
  "name": "Payments-Client", 
  "script": "frappe.ui.form.on(\"Payments\", \"onload\", function(frm) {\n\tfrm.set_query(\"payment_account\", function() {\n\t\treturn {\n\t\t\tfilters: {\n\t\t\t\t\"account_type\": [\"in\", [\"Bank\", \"Cash\"]],\n\t\t\t\t\"is_group\": 0,\n\t\t\t\t\"company\": frm.doc.company\n\t\t\t}\n\t\t}\n\t});\n});\n\nfrappe.ui.form.on(\"Payments\", \"party\", function(frm) {\n\tif(frm.doc.party_type && frm.doc.party) {\n\t\tfrappe.call({\n\t\t\tmethod: \"mapl_customization.customizations_for_mapl.utils.get_party_name\",\n\t\t\targs: {\n\t\t\t\tparty_type: frm.doc.party_type,\n\t\t\t\tparty: frm.doc.party\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\tfrm.set_value(\"party_name\", r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});  \n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.party.get_party_account\",\n\t\t\targs: {\n\t\t\t\tcompany: frm.doc.company,\n\t\t\t\tparty_type: frm.doc.party_type,\n\t\t\t\tparty: frm.doc.party\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\tfrm.set_value(\"party_account\", r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n          frm.call({\n            method: \"mapl_customization.customizations_for_mapl.utils.get_primary_billing_address\",\n            args: {\n\t\t\t\tparty_type: frm.doc.party_type,\n\t\t\t\tparty: frm.doc.party\n            },\n            callback: function(r) {\n                  if(r.message)\n                     frm.set_value(\"party_address\", r.message);\n                  else\n                     frm.set_value(\"party_address\", null);\n                } \n        });\n\t}\n});\n\nfrappe.ui.form.on(\"Payments\", \"party_address\", function(frm) {\n   if (frm.doc.party_address) {\n          frm.call({\n            method: \"mapl_customization.customizations_for_mapl.utils.fetch_address_details_payments_receipts\",\n            args: {\n                party_address: frm.doc.party_address\n            },\n            callback: function(r) {\n                  if(r.message)\n                     frm.set_value(\"address\", r.message);\n                }\n        });   \n   } else\n        frm.set_value(\"address\", null);   \n});\n// Fetch bank/cash account based on payment mode\nfrappe.ui.form.on(\"Payments\", \"payment_mode\", function(frm) {\n\treturn  frappe.call({\n\t\tmethod: \"erpnext.accounts.doctype.sales_invoice.sales_invoice.get_bank_cash_account\",\n\t\targs: {\n\t\t\t\t\"mode_of_payment\": frm.doc.payment_mode,\n\t\t\t\t\"company\": frm.doc.company\n\t\t},\n\t\tcallback: function(r, rt) {\n\t\t\tif(r.message) {\n\t\t\t\tcur_frm.set_value(\"payment_account\", r.message['account']);\n\t\t\t}\n\t\t}\n\t});\n});\n\n\ncur_frm.fields_dict['party_address'].get_query = function(doc, cdt, cdn) {\n      if (doc.party_type==\"Customer\") {\n\treturn{\n    \tfilters:{'customer': doc.party}\n  \t}\n      } else {\n\treturn{\n    \tfilters:{'supplier': doc.party}\n  \t}\n      }\n};", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Order", 
  "modified": "2016-02-18 20:35:34.927711", 
  "name": "Sales Order-Client", 
  "script": "cur_frm.add_fetch('item_code','is_vehicle','is_vehicle');\nfrappe.ui.form.on(\"Sales Order\", \"is_finance\", function (frm) {\n         cur_frm.set_df_property(\"hypothecation\", \"reqd\", frm.doc.is_finance==1);\n         cur_frm.refresh_field(\"hypothecation\");\n});\nfrappe.ui.form.on(\"Sales Order\", \"customer\", function (frm) {\n        cur_frm.set_df_property(\"customer_name\", \"hidden\", false);\n             if (frm.doc.customer) {\n\t\tfrappe.call({\n\t\t\tmethod: \"mapl_customization.customizations_for_mapl.utils.get_customer_balance\",\n\t\t\targs: {\n\t\t\t\tcustomer: frm.doc.customer,\n\t\t\t\tcompany: frm.doc.company\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc && r.message) {\n                                    var alert_msg = frm.doc.customer+\" Current Balance:\";\n                                    if (parseFloat(r.message) > 0) {\n                                          alert_msg = alert_msg+\"<b><span style=\\\"color:red;\\\">\"+parseFloat(r.message)+\" Dr.</span></b>\";\n                                    } else if (parseFloat(r.message) < 0) {\n                                          alert_msg = alert_msg+\"<b><span style=\\\"color:blue;\\\">\"+parseFloat(r.message)+\" Cr.</span></b>\";\n                                    } else {\n                                          alert_msg = alert_msg+\"<b><span style=\\\"color:black;\\\"> 0.00</span></b>\";\n                                    }\n\t\t\t\t\t  \t\t\t\t\t  show_alert(alert_msg, 8);\n\t\t\t\t} else {\n                                          show_alert(frm.doc.customer+\" Current Balance:<b><span style=\\\"color:black;\\\"> 0.00</span></b>\",8);\n                                    }\n\t\t\t}\n\t\t});          \n            }\n});", 
  "script_type": "Client"
 }
]